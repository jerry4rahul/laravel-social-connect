# Laravel Social Connect (Stateless Edition)

[![Latest Version on Packagist](https://img.shields.io/packagist/v/your-vendor/laravel-social-connect.svg?style=flat-square)](https://packagist.org/packages/your-vendor/laravel-social-connect)
[![Total Downloads](https://img.shields.io/packagist/dt/your-vendor/laravel-social-connect.svg?style=flat-square)](https://packagist.org/packages/your-vendor/laravel-social-connect)

**Connect and interact with multiple social media platforms (Facebook Pages, Instagram Business/Creator, Twitter/X, LinkedIn Company Pages, YouTube Channels) directly from your Laravel application.**

**Important Note:** This version of the package operates in a **stateless** manner. It **does not** include database migrations or models for storing authentication tokens, posts, metrics, or other social media data. You, the user, are responsible for implementing your own data storage mechanisms (e.g., database tables, models) to manage credentials and persist the data retrieved or generated by this package.

This approach provides maximum flexibility, allowing you to integrate the package seamlessly into your existing application architecture and data models.

## Features

*   **Multi-Platform Support:** Facebook, Instagram, Twitter/X, LinkedIn, YouTube.
*   **Authentication:** Handles OAuth 2.0 (and OAuth 1.0a for Twitter) flows to obtain access tokens (you store the tokens).
*   **Publishing:** Publish text, images, videos, and links to supported platforms.
*   **Metrics & Insights:** Retrieve account-level and post-level analytics.
*   **Direct Messaging:** Fetch conversations/messages and send replies (where supported by API, e.g., Facebook Pages, Instagram, Twitter DM, LinkedIn Messaging, YouTube Live Chat).
*   **Comment Management:** Fetch comments/replies, post new comments/replies, like, moderate (hide/delete).
*   **Stateless Design:** Provides services to interact with APIs; you manage data persistence.
*   **Consistent Interface:** Uses a `SocialConnectManager` and platform-specific services for easy interaction.

## Installation

You can install the package via composer:

```bash
composer require your-vendor/laravel-social-connect
```

Next, publish the configuration file:

```bash
php artisan vendor:publish --provider="VendorName\SocialConnect\SocialConnectServiceProvider" --tag="config"
```

This will create a `config/social-connect.php` file. **There are no migrations to run.**

## Configuration

Open `config/social-connect.php` and fill in the API credentials (client ID, client secret, etc.) for each social media platform you intend to use. You **must** obtain these credentials by registering applications on the respective developer platforms (Facebook for Developers, Twitter Developer Portal, LinkedIn Developer Portal, Google Cloud Console for YouTube).

```php
// config/social-connect.php

return [
    "platforms" => [
        "facebook" => [
            "client_id" => env("FACEBOOK_CLIENT_ID"),
            "client_secret" => env("FACEBOOK_CLIENT_SECRET"),
            "redirect_uri" => env("FACEBOOK_REDIRECT_URI"),
            "graph_version" => "v19.0",
            "scopes" => [/* Required permissions */],
            "services" => [
                "auth" => VendorName\SocialConnect\Services\Facebook\FacebookService::class,
                "publisher" => VendorName\SocialConnect\Services\Facebook\FacebookPublishingService::class,
                // ... other services
            ],
        ],
        "instagram" => [
            // Requires Facebook App credentials
            "client_id" => env("INSTAGRAM_CLIENT_ID", env("FACEBOOK_CLIENT_ID")),
            "client_secret" => env("INSTAGRAM_CLIENT_SECRET", env("FACEBOOK_CLIENT_SECRET")),
            "redirect_uri" => env("INSTAGRAM_REDIRECT_URI", env("FACEBOOK_REDIRECT_URI")),
            "graph_version" => "v19.0",
            "scopes" => [/* Required permissions */],
            "services" => [
                // ... services
            ],
        ],
        "twitter" => [
            "client_id" => env("TWITTER_CLIENT_ID"), // API Key for v2
            "client_secret" => env("TWITTER_CLIENT_SECRET"), // API Key Secret for v2
            "bearer_token" => env("TWITTER_BEARER_TOKEN"), // Optional for App-only context
            "access_token" => env("TWITTER_ACCESS_TOKEN"), // For v1.1 compatibility if needed
            "access_token_secret" => env("TWITTER_ACCESS_TOKEN_SECRET"), // For v1.1 compatibility
            "redirect_uri" => env("TWITTER_REDIRECT_URI"),
            "scopes" => [/* Required v2 scopes: tweet.read, tweet.write, users.read, offline.access, etc. */],
            "services" => [
                // ... services
            ],
        ],
        "linkedin" => [
            "client_id" => env("LINKEDIN_CLIENT_ID"),
            "client_secret" => env("LINKEDIN_CLIENT_SECRET"),
            "redirect_uri" => env("LINKEDIN_REDIRECT_URI"),
            "scopes" => [/* Required permissions: r_liteprofile, r_emailaddress, w_member_social, r_organization_social, w_organization_social, etc. */],
            "services" => [
                // ... services
            ],
        ],
        "youtube" => [
            "client_id" => env("YOUTUBE_CLIENT_ID"),
            "client_secret" => env("YOUTUBE_CLIENT_SECRET"),
            "redirect_uri" => env("YOUTUBE_REDIRECT_URI"),
            "developer_key" => env("YOUTUBE_API_KEY"), // Optional, for public data
            "scopes" => [/* Required permissions: youtube.upload, youtube.readonly, youtube.force-ssl, etc. */],
            "services" => [
                // ... services
            ],
        ],
    ],

    // Optional global settings
    "http_client_options" => [
        // Guzzle HTTP client options (e.g., timeout, proxy)
        // "timeout" => 30,
    ],
];
```

Make sure to add the corresponding environment variables to your `.env` file.

## Usage

Since this package is stateless, you need to manage the authentication flow and token storage yourself. Hereâ€™s a conceptual overview and examples:

### 1. Authentication Flow (Conceptual)

*   **Step 1: Redirect to Provider:** Use the `authenticator` service to get the redirect URL.
    ```php
    use VendorName\SocialConnect\Facades\SocialConnect; // Assuming you create a Facade
    // Or use dependency injection: app(VendorName\SocialConnect\SocialConnectManager::class)

    public function redirectToFacebook()
    {
        $authUrl = SocialConnect::authenticator("facebook")->getAuthenticationUrl(["email", "pages_show_list"]);
        return redirect($authUrl);
    }
    ```
*   **Step 2: Handle Callback:** The user is redirected back to your specified `redirect_uri`. Exchange the received code for an access token.
    ```php
    use Illuminate\Http\Request;

    public function handleFacebookCallback(Request $request)
    {
        $code = $request->input("code");
        if (!$code) {
            // Handle error: Authorization denied
            return redirect("/home")->withErrors("Facebook authorization failed.");
        }

        try {
            $tokenData = SocialConnect::authenticator("facebook")->getAccessToken($code);
            // $tokenData will contain keys like "access_token", "expires_in", "refresh_token" (if applicable)

            // !!! YOUR RESPONSIBILITY !!!
            // Store the $tokenData securely, associating it with your user and the platform.
            // Example: Create or update your own `UserSocialTokens` model.
            // $user->socialTokens()->updateOrCreate([
            //     "platform" => "facebook",
            // ], [
            //     "access_token" => $tokenData["access_token"],
            //     "refresh_token" => $tokenData["refresh_token"] ?? null,
            //     "expires_at" => now()->addSeconds($tokenData["expires_in"] ?? 3600),
            //     "scopes" => $tokenData["scopes"] ?? [], // Store granted scopes
            // ]);

            // Optionally, fetch basic user profile info immediately
            $profile = SocialConnect::authenticator("facebook")->getUserProfile($tokenData["access_token"]);
            // Store profile info as needed (e.g., platform user ID, name, email)

            return redirect("/home")->with("success", "Facebook account connected!");

        } catch (\Exception $e) {
            // Log the error
            Log::error("Facebook token exchange failed: " . $e->getMessage());
            return redirect("/home")->withErrors("Failed to connect Facebook account.");
        }
    }
    ```
*   **Step 3: Token Refresh (Where Applicable):** For platforms with refresh tokens (like Google/YouTube, LinkedIn, potentially Facebook), you need to implement logic to refresh the access token when it expires using the stored refresh token.
    ```php
    // Conceptual - within your application logic where you retrieve the token
    // $storedToken = // Get stored token data for the user/platform
    // if (now()->gte($storedToken->expires_at->subMinutes(5))) { // Check if expired or close to expiry
    //     try {
    //         $newTokenData = SocialConnect::authenticator("youtube")->refreshAccessToken($storedToken->refresh_token);
    //         // !!! YOUR RESPONSIBILITY !!!
    //         // Update the stored token data with new access_token and expires_at
    //         // $storedToken->update([...]);
    //         $accessToken = $newTokenData["access_token"];
    //     } catch (\Exception $e) {
    //         // Handle refresh failure - user might need to re-authenticate
    //     }
    // } else {
    //     $accessToken = $storedToken->access_token;
    // }
    ```

### 2. Making API Calls (Stateless)

Once you have a valid access token (stored and retrieved by your application), you can use the package services. You **must** pass the required credentials (access token, sometimes token secret for Twitter v1.1) to each method.

**Example: Publishing a Post**

```php
use VendorName\SocialConnect\Facades\SocialConnect;

public function publishToTwitter(Request $request)
{
    // !!! YOUR RESPONSIBILITY !!!
    // Retrieve the stored access token and secret for the user and Twitter
    $accessToken = // ... get user's Twitter access token ...
    $tokenSecret = // ... get user's Twitter token secret (needed for v1.1 actions if used) ...
    $twitterUserId = // ... get user's Twitter platform ID ...

    $text = $request->input("tweet_text");

    try {
        $publisher = SocialConnect::publisher("twitter");
        $result = $publisher->publishText($accessToken, $tokenSecret, $twitterUserId, $text);

        // $result contains data like ["platform" => "twitter", "platform_post_id" => "12345...", "raw_response" => {...}]

        // !!! YOUR RESPONSIBILITY !!!
        // Store the platform_post_id and any other relevant info from $result
        // Log::info("Tweet published: " . $result["platform_post_id"]);

        return back()->with("success", "Tweet published successfully!");

    } catch (\VendorName\SocialConnect\Exceptions\PublishingException $e) {
        Log::error("Twitter publishing failed: " . $e->getMessage());
        return back()->withErrors("Failed to publish tweet: " . $e->getMessage());
    } catch (\Exception $e) {
        Log::error("An unexpected error occurred: " . $e->getMessage());
        return back()->withErrors("An unexpected error occurred.");
    }
}
```

**Example: Getting Account Metrics**

```php
use VendorName\SocialConnect\Facades\SocialConnect;

public function getFacebookPageInsights()
{
    // !!! YOUR RESPONSIBILITY !!!
    $accessToken = // ... get user's Facebook Page access token ...
    $pageId = // ... get the Facebook Page ID ...

    try {
        $metricsService = SocialConnect::metrics("facebook");
        $metrics = ["page_impressions", "page_engaged_users", "page_fan_adds"];
        $since = now()->subDays(28)->format("Y-m-d");
        $until = now()->format("Y-m-d");

        $result = $metricsService->getAccountMetrics($accessToken, "", $pageId, $metrics, $since, $until, "day");

        // $result contains structured metrics data
        // e.g., $result["metrics"]["page_impressions"]["2025-05-28"] = 1500;

        // !!! YOUR RESPONSIBILITY !!!
        // Process and store/display the $result data as needed.

        return view("insights.facebook", ["insights" => $result]);

    } catch (\VendorName\SocialConnect\Exceptions\MetricsException $e) {
        Log::error("Facebook metrics retrieval failed: " . $e->getMessage());
        return back()->withErrors("Failed to retrieve Facebook insights: " . $e->getMessage());
    }
}
```

**Example: Getting Comments**

```php
use VendorName\SocialConnect\Facades\SocialConnect;

public function getYouTubeVideoComments($videoId)
{
    // !!! YOUR RESPONSIBILITY !!!
    $accessToken = // ... get user's YouTube access token ...

    try {
        $commenter = SocialConnect::commenter("youtube");
        $result = $commenter->getComments($accessToken, "", $videoId, 50);

        // $result contains ["comments" => [...], "next_cursor" => "..."]
        // Each comment in the array is structured data (id, message, author, etc.)

        // !!! YOUR RESPONSIBILITY !!!
        // Store or display the comments.
        // If $result["next_cursor"] exists, store it to fetch the next page.

        return view("comments.youtube", ["commentsData" => $result]);

    } catch (\VendorName\SocialConnect\Exceptions\CommentException $e) {
        Log::error("YouTube comment retrieval failed: " . $e->getMessage());
        return back()->withErrors("Failed to retrieve YouTube comments: " . $e->getMessage());
    }
}
```

### 3. Available Services

You can access the specific service for each platform using the `SocialConnectManager`:

*   `SocialConnect::authenticator(string $platform)`: Handles authentication URLs, token exchange, token refresh, user profile retrieval.
*   `SocialConnect::publisher(string $platform)`: Handles publishing text, images, videos, links; deleting posts.
*   `SocialConnect::metrics(string $platform)`: Handles retrieving account and post metrics, audience data, historical trends.
*   `SocialConnect::messenger(string $platform)`: Handles retrieving conversations/messages, sending messages/replies.
*   `SocialConnect::commenter(string $platform)`: Handles retrieving comments/replies, posting comments/replies, reacting, moderating.

Refer to the specific service class implementations and the contracts (`PublishableInterface`, `MetricsInterface`, etc.) for detailed method signatures and expected parameters (including access tokens).

### 4. Returned Data Structures

Each service method returns an array containing relevant data. Key fields often include:

*   `platform`: The name of the social platform (e.g., `facebook`).
*   `platform_post_id`, `platform_comment_id`, `platform_message_id`: The unique ID assigned by the social platform.
*   `metrics`: An array containing the requested metrics data, often keyed by metric name and potentially date or dimension.
*   `comments`, `messages`, `conversations`: Arrays of structured data representing the retrieved items.
*   `next_cursor`: A pagination token to use for fetching the next page of results (if available).
*   `raw_response`: The original, unprocessed response object from the underlying SDK or API call (useful for debugging or accessing data not explicitly formatted by the package).

It is your application's responsibility to parse and store the relevant information from these returned arrays.

## Error Handling

The package throws specific exceptions for different types of errors (e.g., `AuthenticationException`, `PublishingException`, `MetricsException`, `MessagingException`, `CommentException`), all extending a base `SocialConnectException`. You should wrap your calls in `try...catch` blocks to handle these potential errors gracefully.

Common errors include:

*   Invalid or expired access tokens (may require token refresh or user re-authentication).
*   Insufficient permissions (ensure you request the correct scopes during authentication).
*   API rate limits.
*   Platform-specific errors (e.g., content policy violations, invalid post formats).

Check the exception message for details provided by the underlying API or SDK.

## Contributing

Please see CONTRIBUTING for details.

## Security Vulnerabilities

Please review our security policy on how to report security vulnerabilities.

## Credits

*   [Your Name / Company](link-to-your-profile)
*   All Contributors

## License

The MIT License (MIT). Please see [License File](LICENSE.md) for more information.

